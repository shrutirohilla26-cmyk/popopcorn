<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QLHJH03531"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QLHJH03531');
</script>
<meta charset="UTF-8">
<title>Popcorn Catch ‚Äì Cinema Edition (Addictive)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;font-family: system-ui, sans-serif;}
canvas{display:block;}
button{
  padding:10px 18px; font-size:16px; border:none; border-radius:12px;
  cursor:pointer; background:#ff6b6b; color:#fff; margin-top:12px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
addEventListener("resize", resize);
resize();

/* ================= BUCKET ================= */
const bucket = { width: canvas.width * 0.24, height: canvas.width * 0.30, x: canvas.width/2, y: canvas.height - canvas.width*0.30 - 20 };
let dragging = false;
function pointerX(e){ return e.touches ? e.touches[0].clientX : e.clientX; }
canvas.addEventListener("mousedown",()=>dragging=true);
canvas.addEventListener("mouseup",()=>dragging=false);
canvas.addEventListener("mouseleave",()=>dragging=false);
canvas.addEventListener("mousemove",e=>{ if(dragging) bucket.x = pointerX(e); });
canvas.addEventListener("touchstart",()=>dragging=true,{passive:false});
canvas.addEventListener("touchend",()=>dragging=false);
canvas.addEventListener("touchmove",e=>{ e.preventDefault(); if(dragging) bucket.x = pointerX(e);},{passive:false});

/* ================= GAME DATA ================= */
let kernels = [], crumbs = [];
let score = 0, speed = 3, gameOver = false;
let lastSpawn = 0, spawnInterval = 700;
let waveTimer = 0;
let bombs = [];
let explosions = [];
let lastBombSpawn = 0;
let bombInterval = 3500; // one bomb every ~3.5 sec
let gameOverTimer = 0; // frames to show explosion before ending


/* ================= SPAWN POPCORN ================= */
function spawn(){ 
  kernels.push({ 
    x: Math.random()*canvas.width, 
    y: -20, 
    r: canvas.width*0.022, 
    vy: speed + Math.random()*2, 
    rot: Math.random()*6, 
    scale: 0,
    wobble: Math.random()*2,      // horizontal zigzag width
    offset: Math.random()*1000     // phase for sine movement
  }); 
}


function spawnCrumbs(x,y){ 
  for(let i=0;i<12;i++){ 
    crumbs.push({ 
      x,y, 
      vx:(Math.random()-0.5)*6, 
      vy:(Math.random()-0.5)*6, 
      life:30, 
      r:2+Math.random()*2 
    }); 
  } 
}
/* ================= BACKGROUND ================= */
function drawBackground(){
  const g = ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#111"); g.addColorStop(1,"#000"); ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.globalAlpha = 0.15; ctx.fillStyle = "#fff2cc"; ctx.fillRect(0,0,canvas.width,canvas.height*0.25); ctx.globalAlpha = 1;
  ctx.fillStyle = "#050505";
  for(let i=0;i<canvas.width;i+=40){ ctx.beginPath(); ctx.arc(i, canvas.height-35, 30, Math.PI, 0); ctx.fill(); }
}

/* ================= BUCKET DRAW ================= */
function drawBucket(){
  const x = bucket.x - bucket.width/2, y = bucket.y;
  ctx.fillStyle="#fff"; ctx.fillRect(x,y,bucket.width,bucket.height);
  ctx.fillStyle="#e53935"; for(let i=0;i<bucket.width;i+=bucket.width/5){ ctx.fillRect(x+i,y,bucket.width/10,bucket.height); }
  ctx.fillStyle="#f5f5f5"; ctx.fillRect(x-6,y-14,bucket.width+12,18);
  ctx.fillStyle="rgba(0,0,0,0.3)"; ctx.fillRect(x,y+bucket.height-10,bucket.width,10);
}

/* ================= POPCORN DRAW ================= */
function drawKernel(k){
  ctx.save(); ctx.translate(k.x, k.y); ctx.rotate(k.rot); ctx.scale(k.scale,k.scale);
  ctx.fillStyle = "#fff8dc"; ctx.strokeStyle="#f1c232"; ctx.lineWidth=2;
  ctx.beginPath();
  ctx.arc(-k.r*0.4,0,k.r*0.6,0,Math.PI*2); ctx.arc(k.r*0.3,-k.r*0.2,k.r*0.7,0,Math.PI*2);
  ctx.arc(0,k.r*0.3,k.r*0.65,0,Math.PI*2); ctx.arc(-k.r*0.1,-k.r*0.5,k.r*0.55,0,Math.PI*2);
  ctx.fill(); ctx.stroke();
  ctx.fillStyle="rgba(255,200,80,0.6)"; ctx.beginPath();
  ctx.arc(k.r*0.2,k.r*0.1,k.r*0.18,0,Math.PI*2); ctx.arc(-k.r*0.25,k.r*0.2,k.r*0.15,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="rgba(255,255,255,0.7)"; ctx.beginPath(); ctx.arc(-k.r*0.2,-k.r*0.3,k.r*0.25,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

/* ================= SCORE ================= */
function drawScore(){ ctx.fillStyle="rgba(0,0,0,0.6)"; ctx.fillRect(20,20,170,45); ctx.fillStyle="#fff"; ctx.font="22px sans-serif"; ctx.fillText("üçø "+score,45,50); }

/* ================= PERSONALITY ================= */
function generatePersonality(score){
  if(score<10) return "You're playful and curious! Keep catching more popcorn!";
  else if(score<20) return "You're determined and focused! Great job!";
  else if(score<35) return "You're skilled and agile! You're a popcorn master!";
  else return "Legendary! Nothing can stop your popcorn skills!";
}

/* ================= END GAME OVERLAY ================= */
function showEndGame(){
  const overlay = document.createElement("div");
  overlay.style.position="fixed"; overlay.style.inset="0";
  overlay.style.background="rgba(0,0,0,0.95)";
  overlay.style.display="flex"; overlay.style.alignItems="center"; overlay.style.justifyContent="center";
  overlay.style.flexDirection="column"; overlay.style.zIndex=9999;
  document.body.appendChild(overlay);

  const card = document.createElement("div");
  card.style.width="90%"; card.style.maxWidth="400px"; card.style.background="linear-gradient(135deg,#1a1a1a,#000)";
  card.style.color="#fff"; card.style.padding="28px"; card.style.borderRadius="24px"; card.style.textAlign="center";
  card.style.boxShadow="0 0 50px rgba(255,200,0,0.45)"; overlay.appendChild(card);

  const title = document.createElement("h2"); title.innerText="Your Score"; card.appendChild(title);
  const scoreElem = document.createElement("p"); scoreElem.style.fontSize="28px"; scoreElem.style.fontWeight="bold";
  scoreElem.innerText=score; card.appendChild(scoreElem);

  const personalityTitle = document.createElement("h3"); personalityTitle.innerText="Your Popcorn Personality!"; personalityTitle.style.marginTop="18px"; card.appendChild(personalityTitle);
  const desc = document.createElement("p"); desc.style.fontSize="18px"; desc.style.margin="8px 0 12px 0"; desc.innerText = generatePersonality(score); card.appendChild(desc);

  const btn = document.createElement("button"); btn.innerText="PLAY AGAIN"; btn.onclick=()=>location.reload(); card.appendChild(btn);
}

/* ================= DRAW BOMB FUNCTION ================= */
function drawBomb(b){
  // body
  const g = ctx.createRadialGradient(
    b.x - b.r/3, b.y - b.r/3, b.r/4,
    b.x, b.y, b.r
  );
  g.addColorStop(0, "#444");
  g.addColorStop(1, "#000");

  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
  ctx.fill();

  // subtle highlight
  ctx.fillStyle = "rgba(255,255,255,0.08)";
  ctx.beginPath();
  ctx.arc(b.x - b.r/4, b.y - b.r/4, b.r/3, 0, Math.PI * 2);
  ctx.fill();

  // fuse (small)
  ctx.strokeStyle = "#ff9800";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(b.x, b.y - b.r);
  ctx.lineTo(b.x + 8, b.y - b.r - 10);
  ctx.stroke();
}
function spawnExplosion(x, y) {
  for (let i = 0; i < 40; i++) {  // 20 ‚Üí 40 particles
    explosions.push({
      x,
      y,
      vx: (Math.random() - 0.5) * 12, // speed thoda tez
      vy: (Math.random() - 0.5) * 12,
      r: 2 + Math.random() * 4,       // size thoda bada
      life: 40                        // longer life
    });
  }
}


/* ================= GAME LOOP ================= */
function loop(time) {
  if (gameOver) return;

  // 1Ô∏è‚É£ Draw background
  drawBackground();

  // 2Ô∏è‚É£ Surprise wave: increase speed every 8s
  if (time - waveTimer > 8000) {
    speed += 2.1;
    waveTimer = time;
  }

  // 3Ô∏è‚É£ Spawn popcorn
  if (time - lastSpawn > spawnInterval) {
    spawn(); // your spawn() function for kernels
    lastSpawn = time;
  }

  // 4Ô∏è‚É£ Spawn bombs (after score ‚â• 5)
  if (score >= 5 && time - lastBombSpawn > bombInterval) {
    bombs.push({
      x: Math.random() * canvas.width,
      y: -30,
      r: canvas.width * 0.02,
      vy: speed + 3
    });
    lastBombSpawn = time;
  }

  // 5Ô∏è‚É£ Update & draw popcorn
  for (let i = kernels.length - 1; i >= 0; i--) {
    const k = kernels[i];
    if (k.scale < 1) k.scale += 0.08;
    k.x += Math.sin((k.y + k.offset) * 0.02) * k.wobble; // zigzag
    k.y += k.vy;
    drawKernel(k);

    // Catch logic
    if (
      k.y > bucket.y &&
      k.x > bucket.x - bucket.width/2 &&
      k.x < bucket.x + bucket.width/2
    ) {
      spawnCrumbs(k.x, k.y);
      kernels.splice(i, 1);
      score++;
    } 
    else if (k.y > canvas.height) {
  spawnExplosion(k.x, k.y);  // optional, thoda effect
  kernels.splice(i, 1);       // remove the missed popcorn
  gameOverTimer = 60;         // delay before showing score card
}

  }

  // 6Ô∏è‚É£ Update & draw bombs
  for (let i = bombs.length - 1; i >= 0; i--) {
    const b = bombs[i];
    b.y += b.vy;
    drawBomb(b);

 // Bomb collision = instant explosion, delay game over
if (
  b.y > bucket.y &&
  b.x > bucket.x - bucket.width/2 &&
  b.x < bucket.x + bucket.width/2
) {
  spawnExplosion(b.x, b.y);
  bombs.splice(i, 1);
  gameOverTimer = 60; // ~1 second explosion duration
}

    // Remove if off screen
    if (b.y > canvas.height) bombs.splice(i, 1);
  }

  // 7Ô∏è‚É£ Update & draw crumbs
  for (let i = crumbs.length - 1; i >= 0; i--) {
    const c = crumbs[i];
    c.x += c.vx;
    c.y += c.vy;
    c.life--;
    ctx.fillStyle = "#ffe082";
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
    ctx.fill();
    if (c.life <= 0) crumbs.splice(i, 1);
  }
// Draw & update explosions
for (let i = explosions.length - 1; i >= 0; i--) {
  const e = explosions[i];
  e.x += e.vx;
  e.y += e.vy;
  e.life--;
  ctx.fillStyle = `rgba(255, ${Math.floor(Math.random()*150)}, 0, ${e.life/40})`;
  ctx.beginPath();
  ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
  ctx.fill();
  if (e.life <= 0) explosions.splice(i, 1);
}

  // 8Ô∏è‚É£ Draw bucket & score
  drawBucket();
  drawScore();

// 9Ô∏è‚É£ Game over overlay
if (gameOverTimer > 0) {
  gameOverTimer--;
  if (gameOverTimer === 0) {
    gameOver = true;   
    showEndGame();     // ‚úÖ call here to show score card after explosion
  }
}
  // 10Ô∏è‚É£ Next frame
  requestAnimationFrame(loop);
}

// Start the game
requestAnimationFrame(loop);

</script>
</body>
</html>
